{"ast":null,"code":"import{SERVER_URL}from'../config';import URL from'constants/url';import CODE from'constants/code';import{getSessionItem,setSessionItem}from'utils/storage';export function getQueryString(params){return\"?\".concat(Object.entries(params).map(e=>e.join('=')).join('&'));}export function requestFetch(url,requestOptions,handler,errorHandler){console.groupCollapsed(\"requestFetch\");console.log(\"requestFetch [URL] : \",SERVER_URL+url);console.log(\"requestFetch [requestOption] : \",requestOptions);// Login 했을경우 JWT 설정\nconst sessionUser=getSessionItem('loginUser');const sessionUserId=(sessionUser===null||sessionUser===void 0?void 0:sessionUser.id)||null;const jToken=getSessionItem('jToken');if(sessionUserId!=null&&sessionUserId!==undefined){if(!requestOptions['headers'])requestOptions['headers']={};if(!requestOptions['headers']['Authorization'])requestOptions['headers']['Authorization']=null;requestOptions['headers']['Authorization']=jToken;}//CORS ISSUE 로 인한 조치 - origin 및 credentials 추가 \n// origin 추가\nif(!requestOptions['origin']){requestOptions={...requestOptions,origin:SERVER_URL};}// credentials 추가 \nif(!requestOptions['credentials']){requestOptions={...requestOptions,credentials:'include'};}fetch(SERVER_URL+url,requestOptions).then(response=>{// response Stream. Not completion object\n//console.log(\"requestFetch [Response Stream] \", response); \nreturn response.json();}).then(resp=>{if(Number(resp.resultCode)===Number(CODE.RCV_ERROR_AUTH)){alert(\"Login Alert\");//index.jsx라우터파일에 jwtAuthentication 함수로 공통 인증을 사용하는 코드 추가로 alert 원상복구\nsetSessionItem('loginUser',{\"id\":\"\"});window.location.href=URL.LOGIN;return false;}else{return resp;}}).then(resp=>{console.groupCollapsed(\"requestFetch.then()\");console.log(\"requestFetch [response] \",resp);if(typeof handler==='function'){handler(resp);}else{console.log('egov fetch handler not assigned!');}console.groupEnd(\"requestFetch.then()\");}).catch(error=>{console.error('There was an error!',error);if(error==='TypeError: Failed to fetch'){alert(\"서버와의 연결이 원활하지 않습니다. 서버를 확인하세요.\");}if(typeof errorHandler==='function'){errorHandler(error);}else{console.error('egov error handler not assigned!');alert(\"ERR : \"+error.message);}}).finally(()=>{console.log(\"requestFetch finally end\");console.groupEnd(\"requestFetch\");});}","map":{"version":3,"names":["SERVER_URL","URL","CODE","getSessionItem","setSessionItem","getQueryString","params","concat","Object","entries","map","e","join","requestFetch","url","requestOptions","handler","errorHandler","console","groupCollapsed","log","sessionUser","sessionUserId","id","jToken","undefined","origin","credentials","fetch","then","response","json","resp","Number","resultCode","RCV_ERROR_AUTH","alert","window","location","href","LOGIN","groupEnd","catch","error","message","finally"],"sources":["/Users/macheewon/Documents/GitHub/aws-winter-yonsei/src/main/frontend/react/src/api/egovFetch.js"],"sourcesContent":["import { SERVER_URL } from '../config';\n\nimport URL from 'constants/url';\nimport CODE from 'constants/code';\nimport { getSessionItem, setSessionItem } from 'utils/storage';\n\nexport function getQueryString(params){\n    return `?${Object.entries(params).map(e => e.join('=')).join('&') }`\n}\n\nexport function requestFetch(url, requestOptions, handler, errorHandler) {\n    console.groupCollapsed(\"requestFetch\");\n    console.log(\"requestFetch [URL] : \", SERVER_URL + url);\n    console.log(\"requestFetch [requestOption] : \", requestOptions);\n\n    // Login 했을경우 JWT 설정\n    const sessionUser = getSessionItem('loginUser');\n    const sessionUserId = sessionUser?.id || null;\n    const jToken = getSessionItem('jToken');\n    if(sessionUserId != null && sessionUserId !== undefined){\n        if( !requestOptions['headers'] ) requestOptions['headers']={}\n        if( !requestOptions['headers']['Authorization'] ) requestOptions['headers']['Authorization']=null;\n        requestOptions['headers']['Authorization'] = jToken;\n    }\n    \n\n    //CORS ISSUE 로 인한 조치 - origin 및 credentials 추가 \n    // origin 추가\n    if (!requestOptions['origin']) {\n        requestOptions = { ...requestOptions, origin: SERVER_URL };\n    }\n    // credentials 추가 \n    if (!requestOptions['credentials']) {\n        requestOptions = { ...requestOptions, credentials: 'include' };\n    }\n\n    fetch(SERVER_URL + url, requestOptions)\n        .then(response => {// response Stream. Not completion object\n            //console.log(\"requestFetch [Response Stream] \", response); \n            return response.json();\n        })\n        .then((resp) => {\n            if (Number(resp.resultCode) === Number(CODE.RCV_ERROR_AUTH)) {\n                alert(\"Login Alert\"); //index.jsx라우터파일에 jwtAuthentication 함수로 공통 인증을 사용하는 코드 추가로 alert 원상복구\n                setSessionItem('loginUser', {\"id\":\"\"});\n                window.location.href = URL.LOGIN;\n                return false;\n            } else {\n                return resp;\n            }\n        })\n        .then((resp) => {\n            console.groupCollapsed(\"requestFetch.then()\");\n            console.log(\"requestFetch [response] \", resp);\n            if (typeof handler === 'function') {\n                handler(resp);\n            } else {\n                console.log('egov fetch handler not assigned!');\n            }\n            console.groupEnd(\"requestFetch.then()\");\n        })\n        .catch(error => {\n            console.error('There was an error!', error);\n            if (error === 'TypeError: Failed to fetch') {\n                alert(\"서버와의 연결이 원활하지 않습니다. 서버를 확인하세요.\");\n            }\n\n            if (typeof errorHandler === 'function') {\n                errorHandler(error);\n            } else {\n                console.error('egov error handler not assigned!');\n                alert(\"ERR : \" + error.message);\n            }\n        })\n        .finally(() => {\n            console.log(\"requestFetch finally end\");\n            console.groupEnd(\"requestFetch\");\n        });\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}